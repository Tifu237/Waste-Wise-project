<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Recycling Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-secondary {
            background-color: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }

        .btn:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }

        /* Main Content */
        .main-content {
            min-height: calc(100vh - 80px);
            padding: 20px 0;
        }

        /* Auth Forms */
        .auth-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 50px auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 20px;
            margin-top: 20px;
        }

        .sidebar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu a {
            display: block;
            padding: 10px 15px;
            text-decoration: none;
            color: #555;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background-color: #3498db;
            color: white;
        }

        .dashboard-main {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Cards */
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Points Display */
        .points-display {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .points-number {
            font-size: 2rem;
            font-weight: bold;
        }

        .level-bar {
            background-color: rgba(255,255,255,0.3);
            height: 10px;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }

        .level-progress {
            height: 100%;
            background-color: white;
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 1001;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.success {
            background-color: #2ecc71;
        }

        .notification.error {
            background-color: #e74c3c;
        }

        .notification.info {
            background-color: #3498db;
        }

        .hidden {
            display: none !important;
        }

        /* New styles for waste listings and messaging */
        .waste-listing {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }

        .listing-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .listing-header h4 {
            margin: 0;
            color: #2c3e50;
        }

        .listing-details p {
            margin: 5px 0;
            color: #666;
        }
        
        .listing-details .user-info {
            font-style: italic;
            color: #777;
            font-size: 14px;
        }

        .messages-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        .user-list {
            list-style: none;
            padding: 0;
            margin: 0;
            background-color: #f0f2f5;
            border-radius: 8px;
            height: 100%;
            overflow-y: auto;
        }
        
        .user-list li {
            padding: 15px;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .user-list li:hover, .user-list li.active {
            background-color: #e2e4e7;
        }
        
        .chat-window {
            display: flex;
            flex-direction: column;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            height: 100%;
        }
        
        .chat-header {
            padding: 15px;
            background-color: #3498db;
            color: white;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
        }

        .message-history {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 15px;
            max-width: 80%;
        }
        
        .message.sent {
            background-color: #3498db;
            color: white;
            margin-left: auto;
        }
        
        .message.received {
            background-color: #e2e4e7;
            color: #333;
            margin-right: auto;
        }
        
        .chat-input {
            padding: 15px;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 10px;
        }
        
        .chat-input .form-control {
            flex-grow: 1;
        }
        
        .resource-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            transition: transform 0.2s ease-in-out;
        }
        
        .resource-card:hover {
            transform: translateY(-5px);
        }
        
        .resource-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .resource-content {
            padding: 15px;
        }
        
        .resource-content h4 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
        }
        
        .leaderboard-table th, .leaderboard-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .leaderboard-table th {
            background-color: #f2f2f2;
        }
        
        .rating-stars {
            color: #f39c12;
        }
        
        /* New styles for deals section */
        .deals-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .deals-tabs .btn {
            background-color: #ecf0f1;
            color: #2c3e50;
        }
        
        .deals-tabs .btn.active {
            background-color: #3498db;
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: 10px;
            }

            .nav-buttons {
                flex-wrap: wrap;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .messages-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <span>‚ôªÔ∏è</span>
                    <span>Online Recycling Platform</span>
                </div>
                <div class="nav-buttons" id="navButtons">
                    <button class="btn btn-secondary" onclick="showLogin()">Login</button>
                    <button class="btn btn-primary" onclick="showRegister()">Register</button>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div id="landingPage">
                <div class="card" style="margin-top: 50px; text-align: center;">
                    <h1 style="color: #2c3e50; margin-bottom: 20px;">Welcome to Online Recycling Platform</h1>
                    <p style="font-size: 1.2rem; color: #666; margin-bottom: 30px;">
                        Connect waste holders with recycling companies. Make recycling easier, more efficient, and rewarding.
                    </p>
                    <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="showRegister()">Get Started</button>
                        <button class="btn btn-primary" onclick="showLogin()">Login</button>
                    </div>
                </div>
                
                <div class="stats-grid" style="margin-top: 50px;">
                    <div class="stat-card">
                        <div class="stat-number">1,247</div>
                        <div class="stat-label">Active Users</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">
                        <div class="stat-number">5,890</div>
                        <div class="stat-label">Waste Items Recycled</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                        <div class="stat-number">156</div>
                        <div class="stat-label">Partner Companies</div>
                    </div>
                </div>
            </div>

            <div id="loginForm" class="auth-container hidden">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">Login to Your Account</h2>
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginEmail">Email Address</label>
                        <input type="email" id="loginEmail" class="form-control" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" class="form-control" required placeholder="Enter your password">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%; font-size: 16px;">Login</button>
                    </div>
                    <div style="text-align: center;">
                        <a href="#" onclick="showRegister()">Don't have an account? Register here</a>
                    </div>
                </form>
            </div>

            <div id="registerForm" class="auth-container hidden">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">Create Your Account</h2>
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label for="regName">Full Name</label>
                        <input type="text" id="regName" class="form-control" required placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="regEmail">Email Address</label>
                        <input type="email" id="regEmail" class="form-control" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="regPassword">Password</label>
                        <input type="password" id="regPassword" class="form-control" required minlength="6" placeholder="Minimum 6 characters">
                    </div>
                    <div class="form-group">
                        <label for="regPhone">Phone Number</label>
                        <input type="tel" id="regPhone" class="form-control" required placeholder="Enter your phone number">
                    </div>
                    <div class="form-group">
                        <label>Account Type</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="wasteHolder" name="userType" value="waste_holder" required>
                                <label for="wasteHolder">Waste Holder</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="recyclingCompany" name="userType" value="recycling_company" required>
                                <label for="recyclingCompany">Recycling Company</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-success" style="width: 100%; font-size: 16px;">Register</button>
                    </div>
                    <div style="text-align: center;">
                        <a href="#" onclick="showLogin()">Already have an account? Login here</a>
                    </div>
                </form>
            </div>

            <div id="dashboard" class="hidden">
                <div class="dashboard">
                    <div class="sidebar">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <h3 id="userName">User Name</h3>
                            <span id="userType" style="color: #666; font-size: 14px;">User Type</span>
                        </div>
                        
                        <div class="points-display">
                            <div style="font-size: 14px; opacity: 0.9;">Your Points</div>
                            <div class="points-number" id="userPoints">0</div>
                            <div style="font-size: 12px; margin-top: 5px;">Level 1 - New Recycler</div>
                            <div class="level-bar">
                                <div class="level-progress" style="width: 0%;"></div>
                            </div>
                        </div>

                        <ul class="sidebar-menu">
                            <li><a href="#" class="active" onclick="showDashboardSection('overview')">üìä Overview</a></li>
                            <li id="wasteListingLink"><a href="#" onclick="showDashboardSection('waste-listing')">üóëÔ∏è Waste Listings</a></li>
                            <li id="myListingsLink"><a href="#" onclick="showDashboardSection('my-listings')">üìù My Listings</a></li>
                            <li id="availableListingsLink"><a href="#" class="hidden" onclick="showDashboardSection('availableListings')">üóëÔ∏è Available Listings</a></li>
                            <li id="dealsLink"><a href="#" class="hidden" onclick="showDashboardSection('deals')">ü§ù Deals</a></li>
                            <li><a href="#" onclick="showDashboardSection('messages')">‚úâÔ∏è Messages</a></li>
                            <li><a href="#" onclick="showDashboardSection('resources')">üìö Resources</a></li>
                            <li><a href="#" onclick="showDashboardSection('community')">üåç Community</a></li>
                            <li><a href="#" onclick="showDashboardSection('profile')">üë§ Profile</a></li>
                        </ul>
                    </div>

                    <div class="dashboard-main">
                        <div id="overviewSection" class="dashboard-section">
                            <div class="card-header">
                                <h2 class="card-title">Dashboard Overview</h2>
                            </div>
                            
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-number" id="overview-listings">0</div>
                                    <div class="stat-label" id="overview-listings-label">My Listings</div>
                                </div>
                                <div class="stat-card" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">
                                    <div class="stat-number" id="overview-completed">0</div>
                                    <div class="stat-label">Completed Deals</div>
                                </div>
                                <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                                    <div class="stat-number" id="overview-pending">0</div>
                                    <div class="stat-label" id="overview-pending-label">Pending Requests</div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3>Recent Activity</h3>
                                </div>
                                <div id="activity-feed">
                                    <div style="padding: 10px; border-left: 4px solid #3498db; margin-bottom: 10px;">
                                        <strong>Account created successfully!</strong>
                                        <div style="font-size: 12px; color: #666;">Just now</div>
                                    </div>
                                    <div style="padding: 10px; border-left: 4-px solid #2ecc71; margin-bottom: 10px;">
                                        <strong>Welcome to the platform!</strong>
                                        <div style="font-size: 12px; color: #666;">Start by exploring our features</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="waste-listingSection" class="dashboard-section hidden">
                             <div class="card-header">
                                <h2 class="card-title">New Waste Listing</h2>
                            </div>
                             <div class="card">
                                <form id="newListingForm" onsubmit="submitWasteListing(event)">
                                     <div class="form-group">
                                        <label for="wasteType">Type of Waste</label>
                                        <select id="wasteType" class="form-control" required>
                                            <option value="">-- Select --</option>
                                            <option value="Plastic">Plastic</option>
                                            <option value="Paper">Paper/Cardboard</option>
                                            <option value="Glass">Glass</option>
                                            <option value="Metal">Metal</option>
                                            <option value="E-Waste">E-Waste</option>
                                            <option value="Organic">Organic</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="wasteQuantity">Quantity (in kg)</label>
                                        <input type="number" id="wasteQuantity" class="form-control" required min="1" placeholder="e.g., 10">
                                    </div>
                                     <div class="form-group">
                                        <label for="wasteLocation">Location</label>
                                        <input type="text" id="wasteLocation" class="form-control" required placeholder="e.g., 123 Main St, Anytown">
                                    </div>
                                     <div class="form-group">
                                        <label for="wasteTime">Preferred Collection Time</label>
                                        <input type="datetime-local" id="wasteTime" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-success" style="width: 100%; font-size: 16px;">Post Listing</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div id="my-listingsSection" class="dashboard-section hidden">
                            <div class="card-header">
                                <h2 class="card-title">My Waste Listings</h2>
                            </div>
                            <div id="myListingsContainer">
                                <p>You have no active listings.</p>
                            </div>
                        </div>

                        <div id="availableListingsSection" class="dashboard-section hidden">
                             <div class="card-header">
                                <h3 class="card-title">Available Listings for Companies</h3>
                            </div>
                            <div id="availableListings">
                                <p>No new listings available. Check back later!</p>
                            </div>
                        </div>
                        
                        <div id="dealsSection" class="dashboard-section hidden">
                            <div class="card-header">
                                <h3 class="card-title">My Deals</h3>
                            </div>
                            <div class="deals-tabs">
                                <button class="btn active" onclick="showDeals('pending')">Pending</button>
                                <button class="btn" onclick="showDeals('accepted')">Accepted</button>
                                <button class="btn" onclick="showDeals('completed')">Successful</button>
                                <button class="btn" onclick="showDeals('failed')">Failed</button>
                            </div>
                            <div id="dealsContainer">
                                </div>
                        </div>


                        <div id="messagesSection" class="dashboard-section hidden">
                            <div class="card-header">
                                <h2 class="card-title">Messages</h2>
                            </div>
                            <div class="messages-container" style="height: 500px;">
                                <ul class="user-list" id="messageUserList">
                                    </ul>
                                <div class="chat-window">
                                    <div class="chat-header" id="chatHeader">
                                        Select a user to chat
                                    </div>
                                    <div class="message-history" id="messageHistory">
                                        </div>
                                    <form class="chat-input" id="messageForm" onsubmit="sendMessage(event)">
                                        <input type="text" id="messageInput" class="form-control" placeholder="Type a message..." required>
                                        <button type="submit" class="btn btn-primary">Send</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div id="resourcesSection" class="dashboard-section hidden">
                            <div class="card-header">
                                <h2 class="card-title">Educational Resources</h2>
                            </div>
                             <div class="stats-grid" id="resourceList">
                                <div class="resource-card">
                                    <img src="https://images.unsplash.com/photo-1542838139-e4787a29486c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w1MjMyMjV8MHwxfHNlYXJjaHwxfHxyZWN5Y2xpbmclMjBwbGFzdGljfGVufDB8fHx8MTcwMDMwMjM0NXww&ixlib=rb-4.0.3&q=80&w=1080" alt="Recycling plastic bottles">
                                    <div class="resource-content">
                                        <h4>The Ultimate Guide to Plastic Recycling</h4>
                                        <p style="font-size: 14px;">Learn how to identify and properly recycle different types of plastic waste.</p>
                                    </div>
                                </div>
                                <div class="resource-card">
                                    <img src="https://images.unsplash.com/photo-1520696956272-355f34ac06b0?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w1MjMyMjV8MHwxfHxlLWdyZWVuJTIwZW5lcmd5fGVufDB8fHx8MTcwMDMwMjM0OHww&ixlib=rb-4.0.3&q=80&w=1080" alt="Recycling electronic waste">
                                    <div class="resource-content">
                                        <h4>E-Waste: A Growing Problem & What You Can Do</h4>
                                        <p style="font-size: 14px;">Discover the importance of recycling electronics and how to safely dispose of them.</p>
                                    </div>
                                </div>
                                <div class="resource-card">
                                    <img src="https://images.unsplash.com/photo-1621217316744-8c819c96825c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w1MjMyMjV8MHwxfHxjYXJkYm9hcmQlMjByZWN5Y2xpbmd8ZW5mDB8fHx8MTcwMDMwMjM0Nnww&ixlib=rb-4.0.3&q=80&w=1080" alt="Recycling cardboard">
                                    <div class="resource-content">
                                        <h4>Recycling Paper and Cardboard: Best Practices</h4>
                                        <p style="font-size: 14px;">Tips and tricks for maximizing your paper recycling efforts at home or office.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="communitySection" class="dashboard-section hidden">
                             <div class="card-header">
                                <h2 class="card-title">Community Challenges</h2>
                            </div>
                            <div class="card">
                                <h3>Monthly Challenge: Plastic Bottle Bonanza ü•§</h3>
                                <p style="font-size: 16px; margin-top: 10px;">Recycle as many plastic bottles as you can this month! The top 3 recyclers will receive a special badge and bonus points.</p>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3>Recycler Leaderboard</h3>
                                </div>
                                <table class="leaderboard-table">
                                    <thead>
                                        <tr>
                                            <th>Rank</th>
                                            <th>Name</th>
                                            <th>Points</th>
                                        </tr>
                                    </thead>
                                    <tbody id="leaderboardBody">
                                        </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="profileSection" class="dashboard-section hidden">
                            <div class="card-header">
                                <h2 class="card-title">Profile Settings</h2>
                            </div>
                            <div class="card">
                                <h4>Account Information</h4>
                                <div class="form-group">
                                    <label>Full Name</label>
                                    <input type="text" class="form-control" id="profileName" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" class="form-control" id="profileEmail" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Account Type</label>
                                    <input type="text" class="form-control" id="profileType" readonly>
                                </div>
                                <div class="form-group">
                                    <button class="btn btn-primary">Edit Profile</button>
                                    <button class="btn btn-secondary">Change Password</button>
                                </div>
                            </div>
                            <div class="card">
                                <h4>Ratings and Reviews</h4>
                                <div id="ratingsReviews">
                                    <p>No reviews yet.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="notification" class="notification"></div>

    <script>
        // Global data stores (simulating a database)
        let users = [];
        let wasteListings = [];
        let messages = [];
        let leaders = []; // Leaderboard data
        let completedDeals = [];

        // Application state
        let currentUser = null;
        let activeChatUserId = null;

        // Navigation functions
        function showPage(pageId) {
            const pages = ['landingPage', 'loginForm', 'registerForm', 'dashboard'];
            pages.forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
        }

        function showLogin() {
            showPage('loginForm');
        }

        function showRegister() {
            showPage('registerForm');
        }

        function showDashboard() {
            if (!currentUser) return;
            showPage('dashboard');
            updateUserInfo();
            updateNavButtons();
            
            // Show correct dashboard sections based on user type
            const wasteListingLink = document.getElementById('wasteListingLink');
            const myListingsLink = document.getElementById('myListingsLink');
            const availableListingsLink = document.getElementById('availableListingsLink');
            const dealsLink = document.getElementById('dealsLink');

            if (currentUser.type === 'recycling_company') {
                wasteListingLink.classList.add('hidden');
                myListingsLink.classList.add('hidden');
                availableListingsLink.classList.remove('hidden');
                dealsLink.classList.remove('hidden');
                showDashboardSection('availableListings');
            } else {
                wasteListingLink.classList.remove('hidden');
                myListingsLink.classList.remove('hidden');
                availableListingsLink.classList.add('hidden');
                dealsLink.classList.add('hidden');
                showDashboardSection('overview');
            }
        }

        function logout() {
            currentUser = null;
            activeChatUserId = null;
            updateNavButtons();
            showPage('landingPage');
            showNotification('Logged out successfully!', 'info');
        }

        // Authentication functions
        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());

            if (user && user.password === password) {
                currentUser = user;
                showDashboard();
                showNotification('Login successful!', 'success');
            } else {
                showNotification('Invalid email or password!', 'error');
            }
        }

        function handleRegister(event) {
            event.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const phone = document.getElementById('regPhone').value;
            const userType = document.querySelector('input[name="userType"]:checked').value;
            
            if (users.some(u => u.email.toLowerCase() === email.toLowerCase())) {
                showNotification('Email already registered!', 'error');
                return;
            }

            const newUser = {
                id: Date.now(),
                name,
                email,
                password,
                phone,
                type: userType,
                points: 0,
                listings: [],
                deals: [],
                reviews: [],
                messages: []
            };
            users.push(newUser);
            currentUser = newUser;
            
            // Add to initial leaderboard
            leaders.push({ name: newUser.name, points: 0 });
            
            showDashboard();
            showNotification('Registration successful!', 'success');
        }

        // Dashboard functions
        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userType').textContent = currentUser.type === 'waste_holder' ? 'Waste Holder' : 'Recycling Company';
                document.getElementById('userPoints').textContent = currentUser.points.toLocaleString();
                
                // Update profile section
                document.getElementById('profileName').value = currentUser.name;
                document.getElementById('profileEmail').value = currentUser.email;
                document.getElementById('profileType').value = currentUser.type === 'waste_holder' ? 'Waste Holder' : 'Recycling Company';
                
                // Update overview stats
                if (currentUser.type === 'waste_holder') {
                    document.getElementById('overview-listings-label').textContent = 'My Listings';
                    document.getElementById('overview-pending-label').textContent = 'Pending Offers';
                    document.getElementById('overview-listings').textContent = currentUser.listings.length;
                    document.getElementById('overview-completed').textContent = currentUser.listings.filter(l => l.status === 'completed').length;
                    document.getElementById('overview-pending').textContent = currentUser.listings.filter(l => l.status === 'pending').length;
                } else {
                    document.getElementById('overview-listings-label').textContent = 'Deals Made';
                    document.getElementById('overview-pending-label').textContent = 'Pending Deals';
                    document.getElementById('overview-listings').textContent = currentUser.deals.length;
                    document.getElementById('overview-completed').textContent = currentUser.deals.filter(d => d.status === 'completed').length;
                    document.getElementById('overview-pending').textContent = currentUser.deals.filter(d => d.status === 'pending').length;
                }
            }
        }
        
        function updateNavButtons() {
            const navButtons = document.getElementById('navButtons');
            if (currentUser) {
                navButtons.innerHTML = `
                    <span style="color: white; margin-right: 15px;">Welcome, ${currentUser.name}!</span>
                    <button class="btn btn-secondary" onclick="logout()">Logout</button>
                `;
            } else {
                navButtons.innerHTML = `
                    <button class="btn btn-secondary" onclick="showLogin()">Login</button>
                    <button class="btn btn-primary" onclick="showRegister()">Register</button>
                `;
            }
        }

        function showDashboardSection(section) {
            const sections = document.querySelectorAll('.dashboard-section');
            sections.forEach(s => s.classList.add('hidden'));
            document.getElementById(section + 'Section').classList.remove('hidden');
            
            const menuItems = document.querySelectorAll('.sidebar-menu a');
            menuItems.forEach(item => item.classList.remove('active'));
            document.querySelector(`.sidebar-menu a[onclick*="${section}"]`).classList.add('active');
            
            // Re-render content for specific sections
            if (section === 'availableListings') {
                renderAvailableListings();
            } else if (section === 'my-listings') {
                renderMyListings();
            } else if (section === 'messages') {
                renderUserList();
            } else if (section === 'community') {
                renderLeaderboard();
            } else if (section === 'deals') {
                 showDeals('pending');
            }
        }

        // Waste Holder Dashboard Functions
        function submitWasteListing(event) {
            event.preventDefault();
            const wasteType = document.getElementById('wasteType').value;
            const quantity = document.getElementById('wasteQuantity').value;
            const location = document.getElementById('wasteLocation').value;
            const time = document.getElementById('wasteTime').value;

            const newListing = {
                id: Date.now(),
                wasteHolderId: currentUser.id,
                wasteType,
                quantity: parseFloat(quantity),
                location,
                time,
                status: 'pending',
                offers: []
            };
            
            wasteListings.push(newListing);
            currentUser.listings.push(newListing);
            
            showNotification('Waste listing posted successfully!', 'success');
            document.getElementById('newListingForm').reset();
            updateUserInfo();
            showDashboardSection('my-listings');
        }

        function renderMyListings() {
             const container = document.getElementById('myListingsContainer');
             const userListings = currentUser.listings;
             if (userListings.length === 0) {
                container.innerHTML = '<p>You have no active listings. Post a new one!</p>';
                return;
            }
            
            container.innerHTML = userListings.map(listing => `
                <div class="waste-listing">
                    <div class="listing-header">
                        <h4>${listing.wasteType} (${listing.quantity} kg)</h4>
                        <span>Status: <strong>${listing.status}</strong></span>
                    </div>
                    <div class="listing-details">
                        <p><strong>Location:</strong> ${listing.location}</p>
                        <p><strong>Offers:</strong> ${listing.offers.length}</p>
                        ${listing.offers.map(offer => {
                            const company = users.find(u => u.id === offer.companyId);
                            return `
                            <div style="background-color: #eee; padding: 10px; margin-top: 10px; border-radius: 5px;">
                                <p>Offer by <strong>${company.name}</strong></p>
                                <p style="font-size: 14px;">"${offer.message}"</p>
                                <button class="btn btn-success" onclick="acceptOffer(${listing.id}, ${offer.companyId})">Accept Offer</button>
                                <button class="btn btn-secondary" onclick="rejectOffer(${listing.id}, ${offer.companyId})">Reject</button>
                            </div>
                        `}).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        function acceptOffer(listingId, companyId) {
            const listing = currentUser.listings.find(l => l.id === listingId);
            const company = users.find(u => u.id === companyId);
            
            if (listing && company) {
                // Reject other offers and set them to failed
                listing.offers.forEach(offer => {
                    const companyDeal = company.deals.find(d => d.listingId === listing.id && d.companyId === offer.companyId);
                     if (offer.companyId === companyId) {
                         if (companyDeal) companyDeal.status = 'accepted';
                         listing.status = 'accepted';
                     } else {
                         if (companyDeal) companyDeal.status = 'failed';
                     }
                });
                
                listing.acceptedBy = companyId;
                
                // Ensure the company has a deal entry and set it to accepted
                const companyDeal = company.deals.find(d => d.listingId === listing.id);
                if (companyDeal) {
                    companyDeal.status = 'accepted';
                } else {
                    company.deals.push({
                        listingId,
                        wasteHolderId: currentUser.id,
                        status: 'accepted',
                        date: Date.now()
                    });
                }
                
                showNotification(`You accepted an offer from ${company.name}! Check your messages to coordinate.`, 'success');
                renderMyListings();
                updateUserInfo();
                
                // Redirect to messages and start chat
                showDashboardSection('messages');
                setActiveChatUser(companyId);
            }
        }
        
        function rejectOffer(listingId, companyId) {
             const listing = currentUser.listings.find(l => l.id === listingId);
             if (listing) {
                 const company = users.find(u => u.id === companyId);
                 const companyDeal = company.deals.find(d => d.listingId === listingId && d.companyId === companyId);
                 if (companyDeal) companyDeal.status = 'failed';
                 
                 listing.offers = listing.offers.filter(o => o.companyId !== companyId);
                 showNotification('Offer rejected.', 'info');
                 renderMyListings();
                 updateUserInfo();
             }
        }

        // Recycling Company Dashboard Functions
        function renderAvailableListings() {
            const container = document.getElementById('availableListings');
            const available = wasteListings.filter(l => l.status === 'pending');
            if (available.length === 0) {
                container.innerHTML = '<p>No new listings available. Check back later!</p>';
                return;
            }
            
            container.innerHTML = available.map(listing => {
                const wasteHolder = users.find(u => u.id === listing.wasteHolderId);
                return `
                <div class="waste-listing">
                    <div class="listing-header">
                        <h4>${listing.wasteType}</h4>
                    </div>
                    <div class="listing-details">
                        <p><strong>Quantity:</strong> ${listing.quantity} kg</p>
                        <p><strong>Location:</strong> ${listing.location}</p>
                        <p><strong>Waste Holder:</strong> <span class="user-info">${wasteHolder.name}</span></p>
                        <p><strong>Preferred Time:</strong> ${new Date(listing.time).toLocaleString()}</p>
                    </div>
                     <div class="form-group" style="margin-top: 15px;">
                        <input type="text" id="offerMessage-${listing.id}" class="form-control" placeholder="Your offer message...">
                        <button class="btn btn-primary" style="margin-top: 10px;" onclick="makeOffer(${listing.id}, ${listing.wasteHolderId})">Make Offer</button>
                    </div>
                </div>
            `}).join('');
        }
        
        function showDeals(status) {
            const tabs = document.querySelectorAll('.deals-tabs .btn');
            tabs.forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.deals-tabs .btn[onclick*="${status}"]`).classList.add('active');
            
            const container = document.getElementById('dealsContainer');
            const deals = currentUser.deals.filter(d => d.status === status);
            
            if (deals.length === 0) {
                container.innerHTML = `<p>You have no ${status} deals at the moment.</p>`;
                return;
            }
            
            container.innerHTML = deals.map(deal => {
                const listing = wasteListings.find(l => l.id === deal.listingId);
                const wasteHolder = users.find(u => u.id === listing.wasteHolderId);
                
                let buttonHTML = '';
                if (status === 'accepted') {
                    buttonHTML = `<button class="btn btn-success" onclick="completeDeal(${listing.id})">Complete Deal</button>`;
                }
                
                return `
                    <div class="waste-listing">
                        <div class="listing-header">
                            <h4>Deal with ${wasteHolder.name}</h4>
                            ${buttonHTML}
                        </div>
                        <div class="listing-details">
                            <p><strong>Item:</strong> ${listing.quantity} kg of ${listing.wasteType}</p>
                            <p><strong>Location:</strong> ${listing.location}</p>
                            <p><strong>Date:</strong> ${new Date(deal.date).toLocaleDateString()}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function makeOffer(listingId, wasteHolderId) {
            const listing = wasteListings.find(l => l.id === listingId);
            const messageInput = document.getElementById(`offerMessage-${listingId}`);
            const message = messageInput.value.trim();
            
            if (!listing || !message) {
                showNotification('Please enter a message for your offer.', 'error');
                return;
            }
            
            // Add offer to listing
            listing.offers.push({
                companyId: currentUser.id,
                message: message
            });
            
            // Add new deal to company's deals list
            const existingDeal = currentUser.deals.find(d => d.listingId === listingId);
            if (!existingDeal) {
                currentUser.deals.push({
                    listingId,
                    wasteHolderId,
                    status: 'pending',
                    date: Date.now()
                });
            }
            
            // Send message to waste holder
            sendMessage(message, wasteHolderId, currentUser.id);

            showNotification('Offer sent to waste holder!', 'success');
            messageInput.value = '';
            renderAvailableListings();
            updateUserInfo();
        }

        // Shared functions
        // Messaging functions
        function renderUserList() {
            const userList = document.getElementById('messageUserList');
            const wasteHolders = users.filter(u => u.type === 'waste_holder' && u.id !== currentUser.id);
            const recyclingCompanies = users.filter(u => u.type === 'recycling_company' && u.id !== currentUser.id);

            const allUsers = [...wasteHolders, ...recyclingCompanies];
            
            userList.innerHTML = allUsers.map(user => `
                <li onclick="setActiveChatUser(${user.id})" class="${activeChatUserId === user.id ? 'active' : ''}">
                    ${user.name} (${user.type === 'waste_holder' ? 'Waste Holder' : 'Recycling Company'})
                </li>
            `).join('');
            
            if (activeChatUserId) {
                 renderMessages();
            } else {
                 document.getElementById('messageHistory').innerHTML = '';
                 document.getElementById('chatHeader').textContent = 'Select a user to chat';
                 document.getElementById('messageForm').classList.add('hidden');
            }
        }
        
        function setActiveChatUser(userId) {
            activeChatUserId = userId;
            const chatHeader = document.getElementById('chatHeader');
            const chatForm = document.getElementById('messageForm');
            const chatUser = users.find(u => u.id === userId);
            
            if (chatUser) {
                chatHeader.textContent = `Chat with ${chatUser.name}`;
                chatForm.classList.remove('hidden');
            }
            
            renderUserList();
            renderMessages();
        }

        function renderMessages() {
            const messageHistory = document.getElementById('messageHistory');
            const chatMessages = messages.filter(m => 
                (m.senderId === currentUser.id && m.recipientId === activeChatUserId) ||
                (m.senderId === activeChatUserId && m.recipientId === currentUser.id)
            );
            
            if (chatMessages.length === 0) {
                messageHistory.innerHTML = '<p style="text-align: center; color: #999;">Start a conversation!</p>';
            } else {
                messageHistory.innerHTML = chatMessages.map(msg => `
                    <div class="message ${msg.senderId === currentUser.id ? 'sent' : 'received'}">
                        ${msg.content}
                    </div>
                `).join('');
            }
            messageHistory.scrollTop = messageHistory.scrollHeight;
        }
        
        function sendMessage(event, recipientId = null, senderId = null) {
            if (event && event.preventDefault) event.preventDefault();
            
            const content = document.getElementById('messageInput').value.trim();
            const recipient = recipientId || activeChatUserId;
            const sender = senderId || currentUser.id;
            
            if (!content || !recipient) return;
            
            messages.push({
                senderId: sender,
                recipientId: recipient,
                content: content,
                timestamp: Date.now()
            });
            
            document.getElementById('messageInput').value = '';
            
            if (recipientId === null) {
                // If it's a direct chat from the message section
                renderMessages();
                showNotification('Message sent!', 'success');
            }
        }

        // Gamification functions
        function addPoints(userId, points) {
            const user = users.find(u => u.id === userId);
            if (user) {
                user.points += points;
                updateUserInfo();
                updateLeaderboard();
                showNotification(`You've earned ${points} points! üéâ`, 'success');
            }
        }
        
        function completeDeal(listingId) {
            const listing = wasteListings.find(l => l.id === listingId);
            const company = currentUser;
            const holder = users.find(u => u.id === listing.wasteHolderId);
            
            if (listing && company && holder) {
                const points = parseInt(listing.quantity) * 5;
                addPoints(holder.id, points);
                addPoints(company.id, points / 2);
                
                listing.status = 'completed';
                
                const companyDeal = company.deals.find(d => d.listingId === listingId);
                if (companyDeal) {
                    companyDeal.status = 'completed';
                }
                
                // Add deal to holder's history
                const holderListing = holder.listings.find(l => l.id === listingId);
                if (holderListing) {
                    holderListing.status = 'completed';
                }

                showNotification(`Deal completed! You and ${holder.name} earned points.`, 'success');
                showDeals('completed'); // Refresh company view
                updateUserInfo();
            }
        }
        
        function renderLeaderboard() {
            const tbody = document.getElementById('leaderboardBody');
            leaders.sort((a, b) => b.points - a.points);
            
            tbody.innerHTML = leaders.map((leader, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${leader.name}</td>
                    <td>${leader.points}</td>
                </tr>
            `).join('');
        }
        
        function updateLeaderboard() {
            leaders = users.map(user => ({
                name: user.name,
                points: user.points
            }));
            renderLeaderboard();
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            users.push({
                id: 1, name: 'Alice Holder', email: 'alice@example.com', password: 'password', type: 'waste_holder', points: 1247, listings: [], deals: [], reviews: [], messages: []
            });
            users.push({
                id: 2, name: 'Bob Co.', email: 'bob@company.com', password: 'password', type: 'recycling_company', points: 5890, listings: [], deals: [], reviews: [], messages: []
            });
            
            const initialListing = {
                id: 101, wasteHolderId: 1, wasteType: 'Plastic', quantity: 15, location: '123 Main St, Anytown', time: new Date().toISOString(), status: 'pending', offers: []
            };
            wasteListings.push(initialListing);
            users[0].listings.push(initialListing);
            
            const initialDeal = {
                listingId: 101, wasteHolderId: 1, status: 'pending', date: Date.now()
            };
            users[1].deals.push(initialDeal);
            
            leaders = users.map(user => ({ name: user.name, points: user.points }));
        });
    </script>
</body>
</html>